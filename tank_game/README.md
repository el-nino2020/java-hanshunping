# 项目：坦克大战

## 序言

- 该项目分为三个部分来写，因为先后学习了Java绘图技术、多线程基础和文件IO知识
- **运行程序之前**，需要修改`Bomb`和`Recorder`类中的文件路径

## 原版游戏

网址：https://90kids.com/tank-1990/



## 坦克大战（Ver 1.0）

1. 设计思路
	1. 设计`Tank`类，使我方坦克（`MyTank`）和敌方坦克继承该类
	2. 设计`MyPanel`类，继承`JPanel`，用于绘图
	3. 设计`TankGame01`类，继承`JFrame`
	4. 设计`EnemyTank`类，继承`Tank`。`MyPanel`对象存储`Vector<EnemyTank>`对象，因为以后要使用多线程操作敌方坦克



2. 编程过程
	1. 设置背景（`MyPanel.paint()`）和窗口（`TankGame01`）参数
	2. 画坦克：在`MyPanel`类定义一个`drawTank`方法，坦克的设计如图：
		- <img src="https://cdn.jsdelivr.net/gh/el-nino2020/ImageBed/202203240927138.png" alt="image-20220308081029783" style="zoom: 25%;" />
	3. 画出四个朝向的坦克
	4. 让坦克能够移动
	5. 画出3辆地方坦克（这一条属于本章作业）



3. 分析：
	- 程序设计仍然采用分层模式——使用`JFrame`和`JPanel`画图也确实需要这么做
	- 这一部分涉及到绘图技术和事件处理机制的知识点，但编程难度与讲解知识点时相近，可以说是按部就班





## 坦克大战(Ver 2.0)

1. 设计思路
	- 设计`Bullet`类，实现`Runnable`接口，重写`run()`方法以不断改变子弹位置
	- `Mytank`拥有`Bullet`属性。在键盘按下`J`，调用`shot`方法后，`Bullet`对象不断移动（相当于启动一个线程）
	- `Mypanel`需要不断重绘子弹，因此也需要实现`Runnable`接口
	- `EnemyTank`类拥有`Vector<Bullet>`属性
	- 定义`Bomb`类，用于爆炸效果
	- `EnemyTank`实现`Runnable`接口，用于实现坦克自由移动



2. 编程过程
	- 完成`Bullet`类设计，使屏幕上的子弹能移动
	- 使敌方坦克也能发射子弹
	- 我方坦克击中敌方坦克时，敌方坦克消失
	- 坦克消失时产生爆炸效果
	- 敌方坦克可以随机移动
	- 控制坦克的移动范围——不能超出边界
	- 己方坦克发射多颗子弹，以及多颗子弹同时存在的限制
	- 敌方坦克能自动发射子弹
	- 我方坦克被击中后爆炸



3. 总结：
	- 这一部分（也可以说是整个游戏）的重点是多线程，但我掌握得并不特别好
	- 在多线程的实际应用中，应明确：
		- `start()`方法创建线程，线程调用**一次**`run()`方法。至于实现不断重绘子弹、敌方坦克能够自由移动等功能，是依靠`run()`方法中的`while(true){}`，而与多线程问题无关
		- 主线程能够用`start()`创建线程。而线程一旦创建，就**不受主线程的控制**，直至自己消亡。故，重写的`run()`方法应保证能够结束
		- 多个线程只是在时间上并发，每个线程能够使用的数据（即对象）都是定义在主线程中。因此，`Bullet`对象的`run()`方法只负责改变子弹的位置，而`MyPanel`对象的`run()`方法专门调用`repaint()`方法不断画图
	- 实现不同的功能并不需要新的知识点，但对业务逻辑能力有一定需求——不能写bug
	- 使用封装、继承以精简代码，提高代码复用性
	- 一些功能的实现，比如判断坦克是否被击中，只依靠单纯的循环，效率较低。若是使用特定的算法或数据结构，能提高效率——虽然我没有想过如何优化
	- 整个游戏在功能上还有很多需要完善的地方



## 坦克大战(Ver 3.0)

1. 设计思路：
	- 防止坦克重叠运动
		- ![屏幕截图(28)](https://cdn.jsdelivr.net/gh/el-nino2020/ImageBed/202203201247895.png)
		- 根据当前坦克（黄色）的两个顶点（红色）是否落在其他坦克（蓝色）的区域中来判断，一共8种
	- 记录玩家总成绩——总击毁坦克数，并存入文件
	- 记录游戏退出时敌人坦克的坐标和方向（写入文件）
	- 打开程序时，选择新开游戏还是继续上局游戏







2. 编程过程
	- 防止坦克重叠运动，需要在每个敌方坦克的线程中不断循环`enemyTanks`。由于`MyPanel`的`paint`方法会删除`enemyTanks`中消亡的坦克。如果在循环时使用迭代器或增强for，会抛出`ConcurrentModificationException`异常，具体的原理看[这里](https://www.cnblogs.com/dolphin0520/p/3933551.html)。我的解决方式是，使用普通for循环
	- 设计`Recorder`类，记录玩家总成绩，同时写入文件
	- 玩家选择新开游戏，或是继续上局游戏，通过在控制台输入来决定。
	- 增加获胜提示



3. 总结
	- 这一部分继续完善坦克大战的执行逻辑，并增添了文件IO，记录游戏信息。总体来说难度不大
	- 程序本身还是有问题的：如果生成大量敌方坦克，击毁几辆后，仍然会抛出`ConcurrentModificationException`异常。这超出了我现有的关于多线程的知识。所谓解决，也只是将迭代器循环改为普通for循环（并且越改越有问题）。等日后学习了并发的知识再来解决吧。好在普通的游玩（一次生成几辆坦克）并不会触发该异常。





